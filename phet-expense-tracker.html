<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Phet — Personal Habit & Expense Tracker (Preview)</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--muted:#9aa4b2;--accent:#38bdf8;--success:#10b981;--danger:#fb7185;--glass:rgba(255,255,255,0.03)}
    *{box-sizing:border-box}
    body{margin:0;font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,"Helvetica Neue",Arial;background:linear-gradient(180deg,#071127 0%,#071830 100%);color:#e6eef6;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
    .app{width:100%;max-width:980px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;padding:18px;box-shadow:0 6px 24px rgba(2,6,23,0.6);}
    .grid{display:grid;grid-template-columns:1fr 360px;gap:18px}
    .panel{padding:12px}
    .small{font-size:13px;color:var(--muted)}

    form{display:flex;flex-direction:column;gap:8px}
    input, select, button, textarea{border-radius:8px;padding:10px;border:1px solid rgba(255,255,255,0.06);background:transparent;color:inherit}
    input::placeholder{color:rgba(255,255,255,0.35)}
    button{background:var(--accent);border:none;color:#031023;padding:10px 12px;cursor:pointer;font-weight:600}
    .muted{color:var(--muted)}
    .btn-ghost{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted)}
    .list{max-height:300px;overflow:auto;padding-right:8px}
    .expense-row{display:flex;justify-content:space-between;padding:8px;border-radius:8px;background:var(--glass);margin-bottom:8px}
    .category-chip{padding:6px 8px;border-radius:999px;background:rgba(255,255,255,0.03);font-size:13px}
    .warning{color:var(--danger);font-weight:700}
    .ok{color:var(--success);font-weight:700}
    .footer{margin-top:12px;text-align:center;color:var(--muted);font-size:13px}
    .hidden{display:none}
    .top-stats{display:flex;gap:8px}
    .stat{flex:1;padding:10px;background:rgba(255,255,255,0.02);border-radius:10px}
    @media (max-width:880px){.grid{grid-template-columns:1fr;}.card{padding:12px}}
  </style>
</head>
<body>
  <div class="app">
    <header>
      <h1>Phet — Personal Habit & Expense Tracker (Preview)</h1>
      <div class="small muted">No backend — uses browser localStorage • works in this preview</div>
    </header>

    <div class="grid">
      <!-- LEFT: main area -->
      <div class="card panel">
        <!-- Auth area -->
        <div id="auth" class="auth">
          <div id="landing" class="landing">
            <h3>Welcome</h3>
            <p class="small muted">Signup or login to start tracking your expenses.</p>
            <div style="display:flex;gap:8px;margin-top:12px">
              <button id="showSignup">Signup</button>
              <button id="showLogin" class="btn-ghost">Login</button>
            </div>
          </div>

          <form id="signupForm" class="hidden">
            <h3>Create account</h3>
            <input id="suEmail" placeholder="email (must include @gmail.com)" />
            <input id="suUser" placeholder="username (min 8 chars)" />
            <input id="suPass" placeholder="password (min 6 chars)" type="password" />
            <div style="display:flex;gap:8px;margin-top:6px">
              <button type="button" id="doSignup">Create</button>
              <button type="button" id="backFromSignup" class="btn-ghost">Back</button>
            </div>
            <div id="suMsg" class="small muted"></div>
          </form>

          <form id="loginForm" class="hidden">
            <h3>Login</h3>
            <input id="liEmail" placeholder="email" />
            <input id="liPass" placeholder="password" type="password" />
            <div style="display:flex;gap:8px;margin-top:6px">
              <button type="button" id="doLogin">Login</button>
              <button type="button" id="backFromLogin" class="btn-ghost">Back</button>
            </div>
            <div id="liMsg" class="small muted"></div>
          </form>
        </div>

        <!-- Dashboard (hidden until login) -->
        <div id="dashboard" class="hidden">
          <div style="display:flex;justify-content:space-between;align-items:center">
            <div>
              <h3 id="welcomeUser">Hello</h3>
              <div class="small muted">Manage expenses, budgets and categories</div>
            </div>
            <div style="display:flex;gap:8px">
              <button id="logout" class="btn-ghost">Logout</button>
              <button id="deleteAccount" class="btn-ghost">Delete account</button>
            </div>
          </div>

          <div class="top-stats" style="margin-top:12px">
            <div class="stat">
              <div class="small muted">Total spent</div>
              <div id="statTotal">₦0</div>
            </div>
            <div class="stat">
              <div class="small muted">Remaining (budget)</div>
              <div id="statRemain">₦0</div>
            </div>
            <div class="stat">
              <div class="small muted">Entries</div>
              <div id="statEntries">0</div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />

          <!-- Add expense -->
          <div style="display:flex;gap:12px;flex-wrap:wrap">
            <div style="flex:1;min-width:220px">
              <h4>Add expense</h4>
              <div class="small muted">Categories are reusable — you can create new ones</div>
              <form id="addForm">
                <select id="categorySelect"></select>
                <input id="amount" placeholder="amount e.g. 1200" />
                <input id="note" placeholder="note (optional)" />
                <div style="display:flex;gap:8px;margin-top:6px">
                  <button type="button" id="addBtn">Add</button>
                  <button type="button" id="newCatBtn" class="btn-ghost">Add category</button>
                </div>
                <div id="addMsg" class="small muted"></div>
              </form>
            </div>

            <!-- Quick budget control -->
            <div style="width:320px">
              <h4>Budget</h4>
              <div class="small muted">Set or view your daily budget</div>
              <div style="display:flex;gap:8px;margin-top:8px">
                <input id="budgetInput" placeholder="₦10000" />
                <button id="setBudget" class="btn-ghost">Save</button>
              </div>
              <div id="budgetMsg" class="small muted" style="margin-top:8px"></div>

              <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />
              <h4>Summary</h4>
              <div id="summaryBox" class="list"></div>
            </div>
          </div>

          <hr style="margin:12px 0;border:none;border-top:1px solid rgba(255,255,255,0.03)" />

          <div style="display:flex;gap:12px">
            <div style="flex:1">
              <h4>All expenses</h4>
              <div id="expensesList" class="list"></div>
            </div>

            <div style="width:260px">
              <h4>Search / Manage</h4>
              <input id="searchInput" placeholder="Search category" />
              <div style="display:flex;gap:8px;margin-top:6px">
                <button id="searchBtn" class="btn-ghost">Find</button>
                <button id="clearBtn" class="btn-ghost">Clear all (local)</button>
              </div>
              <div id="searchMsg" class="small muted"></div>
            </div>
          </div>

        </div>
      </div>

      <!-- RIGHT: help / tips card -->
      <div class="card panel">
        <h4>How this preview works</h4>
        <ol class="small muted">
          <li>Create an account (email must include <code>@gmail.com</code> for this demo).</li>
          <li>Login, add expenses and categories. Data is saved to <code>localStorage</code>.</li>
          <li>Budget warns when you go over but still records entries.</li>
        </ol>

        <div style="margin-top:12px">
          <h4>Tips</h4>
          <ul class="small muted">
            <li>Try adding multiple categories and expenses.</li>
            <li>Use the "Clear all" button to reset local data.</li>
          </ul>
        </div>

        <div class="footer">Preview created from your Python app logic — tell me what to change</div>
      </div>
    </div>
  </div>

  <script>
    // Simple single-file app using localStorage
    const $ = (id)=>document.getElementById(id);

    // --- App state helpers ---
    function saveUsers(users){localStorage.setItem('phet_users', JSON.stringify(users))}
    function loadUsers(){return JSON.parse(localStorage.getItem('phet_users')||'{}')}
    function saveCurrent(email){localStorage.setItem('phet_current', email)}
    function loadCurrent(){return localStorage.getItem('phet_current')}

    function getUserData(email){
      const users = loadUsers();
      if(users[email]) return users[email];
      // default structure
      return {username:'',password:'',budget:10000,records:{food:[],transport:[],gadget:[]}};
    }

    function saveUserData(email,data){const users=loadUsers();users[email]=data;saveUsers(users)}

    // --- UI elements ---
    const landing = $('landing');
    const signupForm = $('signupForm');
    const loginForm = $('loginForm');
    const dashboard = $('dashboard');

    // auth buttons
    $('showSignup').onclick = ()=>{landing.classList.add('hidden');signupForm.classList.remove('hidden')}
    $('showLogin').onclick = ()=>{landing.classList.add('hidden');loginForm.classList.remove('hidden')}
    $('backFromSignup').onclick = ()=>{signupForm.classList.add('hidden');landing.classList.remove('hidden')}
    $('backFromLogin').onclick = ()=>{loginForm.classList.add('hidden');landing.classList.remove('hidden')}

    // signup
    $('doSignup').onclick = ()=>{
      const email = $('suEmail').value.trim();
      const username = $('suUser').value.trim();
      const password = $('suPass').value;
      if(!email || !username || !password){$('suMsg').textContent='All fields are required.';return}
      if(!email.includes('@gmail.com')){ $('suMsg').textContent='Email must include @gmail.com for demo.';return }
      if(username.length<8){$('suMsg').textContent='Username must be at least 8 characters.';return}
      if(password.length<6){$('suMsg').textContent='Password must be at least 6 characters.';return}
      const users = loadUsers();
      if(users[email]){$('suMsg').textContent='Account already exists.';return}
      users[email]={username,password,budget:10000,records:{food:[],transport:[],gadget:[]}};
      saveUsers(users);
      $('suMsg').textContent='Account created. Logging in...';
      setTimeout(()=>{loginUser(email)},700);
    }

    // login
    $('doLogin').onclick = ()=>{
      const email = $('liEmail').value.trim();
      const password = $('liPass').value;
      const users = loadUsers();
      if(users[email] && users[email].password===password){loginUser(email)}else{$('liMsg').textContent='No record found or wrong password.'}
    }

    function loginUser(email){
      saveCurrent(email);
      const data = getUserData(email);
      $('welcomeUser').textContent = `Welcome, ${data.username}`;
      signupForm.classList.add('hidden'); loginForm.classList.add('hidden'); landing.classList.add('hidden'); dashboard.classList.remove('hidden');
      renderUser(email);
    }

    $('logout').onclick = ()=>{localStorage.removeItem('phet_current');dashboard.classList.add('hidden');landing.classList.remove('hidden')}

    $('deleteAccount').onclick = ()=>{
      const email = loadCurrent(); if(!email) return;
      if(!confirm('Delete account and data?')) return;
      const users = loadUsers(); delete users[email]; saveUsers(users); localStorage.removeItem('phet_current'); alert('Account deleted'); dashboard.classList.add('hidden'); landing.classList.remove('hidden');
    }

    // Add expense
    function renderUser(email){
      const data = getUserData(email);
      // populate categories
      const sel = $('categorySelect'); sel.innerHTML='';
      for(const cat of Object.keys(data.records)){
        const opt = document.createElement('option'); opt.value=cat; opt.textContent=cat; sel.appendChild(opt)
      }
      $('budgetInput').value = data.budget || 10000;
      renderSummary(email);
      renderExpenses(email);
    }

    $('newCatBtn').onclick = ()=>{
      const name = prompt('New category name:'); if(!name) return; const email = loadCurrent(); const data = getUserData(email); if(data.records[name]){alert('Category exists')}else{data.records[name]=[]; saveUserData(email,data); renderUser(email)}
    }

    $('addBtn').onclick = ()=>{
      const email = loadCurrent(); if(!email) return alert('Please login');
      const data = getUserData(email);
      const cat = $('categorySelect').value;
      const amt = parseFloat($('amount').value);
      const note = $('note').value.trim();
      if(isNaN(amt) || amt<=0){$('addMsg').textContent='Enter a valid amount.';return}
      const ts = new Date().toISOString().slice(0,19).replace('T',' ');
      const entry = {amount:amt,time:ts,note};
      data.records[cat].push(entry);
      saveUserData(email,data);
      $('addMsg').textContent='Saved.';
      setTimeout(()=>{$('addMsg').textContent=''},900);
      $('amount').value=''; $('note').value='';
      renderUser(email);
      // budget warning
      const tot = calcTotal(data.records);
      if(tot>data.budget){alert(`⚠️ You have gone over your budget by ₦${(tot-data.budget).toFixed(2)}`)}
    }

    function calcTotal(records){
      let t=0; for(const arr of Object.values(records)) for(const e of arr) t+=Number(e.amount||0); return t;
    }

    function renderSummary(email){ const data=getUserData(email); const total=calcTotal(data.records); const entries = Object.values(data.records).reduce((s,a)=>s+a.length,0); $('statTotal').textContent = `₦${total.toFixed(2)}`; $('statEntries').textContent = entries; $('statRemain').textContent = `₦${(data.budget - total).toFixed(2)}`;
      const sb = $('summaryBox'); sb.innerHTML=''; for(const [cat,arr] of Object.entries(data.records)){
        const div = document.createElement('div'); div.className='expense-row'; div.innerHTML = `<div><div class='category-chip'>${cat}</div><div class='small muted'>${arr.length} entries</div></div><div>₦${(arr.reduce((s,e)=>s+Number(e.amount||0),0)).toFixed(2)}</div>`; sb.appendChild(div);
      }
    }

    function renderExpenses(email){ const data=getUserData(email); const list = $('expensesList'); list.innerHTML=''; for(const [cat,arr] of Object.entries(data.records)){
      for(const e of arr.slice().reverse()){
        const row = document.createElement('div'); row.className='expense-row'; row.innerHTML = `<div><strong>${cat}</strong><div class='small muted'>${e.note||''}</div></div><div>₦${Number(e.amount).toFixed(2)}<div class='small muted'>${e.time}</div></div>`;
        list.appendChild(row);
      }
    }}

    // budget set
    $('setBudget').onclick = ()=>{ const email=loadCurrent(); if(!email) return; const data=getUserData(email); const b = parseFloat($('budgetInput').value); if(isNaN(b)||b<=0){$('budgetMsg').textContent='Enter valid budget';return} data.budget = b; saveUserData(email,data); $('budgetMsg').textContent='Budget saved.'; setTimeout(()=>{$('budgetMsg').textContent=''},900); renderSummary(email)}

    // search / clear
    $('searchBtn').onclick = ()=>{ const q=$('searchInput').value.trim(); const email=loadCurrent(); if(!email) return; const data=getUserData(email); if(!q){$('searchMsg').textContent='Enter a category to search';return} if(data.records[q]){ $('searchMsg').textContent = `Found ${data.records[q].length} entries in ${q}`; } else {$('searchMsg').textContent='No category found'} }

    $('clearBtn').onclick = ()=>{ if(!confirm('Clear ALL users and data from this browser?')) return; localStorage.removeItem('phet_users'); localStorage.removeItem('phet_current'); alert('Cleared local data'); location.reload(); }

    // load current user on start
    (function init(){ const current = loadCurrent(); if(current){ loginUser(current); } })();
  </script>
</body>
</html>
